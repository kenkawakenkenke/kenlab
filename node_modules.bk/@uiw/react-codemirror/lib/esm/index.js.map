{"version":3,"sources":["../../src/index.js"],"names":["React","useRef","useEffect","useImperativeHandle","useState","useMemo","CodeMirror","defaultOptions","tabSize","autoCloseBrackets","matchBrackets","showCursorWhenSelecting","lineNumbers","fullScreen","ReactCodeMirror","props","ref","options","value","width","height","editor","setEditor","textareaRef","getEventHandleFromProps","propNames","Object","keys","eventHandle","filter","keyName","test","eventDict","forEach","ele","name","slice","replace","toLowerCase","setOptions","instance","opt","window","mode","findModeByName","mime","JSON","stringify","setOption","fromTextArea","current","event","on","setValue","setSize","toTextArea","undefined","val","getValue","forwardRef"],"mappings":"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","sourcesContent":["import React, { useRef, useEffect, useImperativeHandle, useState, useMemo } from 'react';\nimport CodeMirror from 'codemirror';\nimport 'codemirror/mode/meta';\nimport './codemirror.css';\nimport './index.css';\n\nconst defaultOptions = {\n  tabSize: 2,\n  autoCloseBrackets: true,\n  matchBrackets: true,\n  showCursorWhenSelecting: true,\n  // 显示行号\n  lineNumbers: true,\n  fullScreen: true,\n}\n\nfunction ReactCodeMirror(props = {}, ref) {\n  const { options = {}, value = '', width = '100%', height = '100%'  } = props;\n  const [editor, setEditor] = useState();\n  const textareaRef = useRef();\n  useImperativeHandle(ref, () => ({ editor }), [editor]);\n  // 将props中所有的事件处理函数映射并保存\n  function getEventHandleFromProps() {\n    const propNames = Object.keys(props);\n    const eventHandle = propNames.filter((keyName) => {\n      return /^on+/.test(keyName);\n    });\n\n    const eventDict = {};\n    eventHandle.forEach((ele) => {\n      const name = ele.slice(2);\n      eventDict[ele] = name.replace(name[0],name[0].toLowerCase());\n    });\n\n    return eventDict;\n  }\n\n  // http://codemirror.net/doc/manual.html#config\n  async function setOptions(instance, opt = {}) {\n    if (typeof opt === 'object' && window) {\n      const mode = CodeMirror.findModeByName(opt.mode || '');\n      if (mode && mode.mode) {\n        await import(`codemirror/mode/${mode.mode}/${mode.mode}.js`);\n      }\n      if (mode) {\n        opt.mode = mode.mime;\n      }\n      Object.keys(opt).forEach((name) => {\n        if (opt[name] && JSON.stringify(opt[name])) {\n          instance.setOption(name, opt[name]);\n        }\n      });\n    }\n  }\n\n  useEffect(() => {\n    if (!editor && window) {\n      // 生成codemirror实例\n      const instance = CodeMirror.fromTextArea(textareaRef.current, {...defaultOptions, ...options});\n      const eventDict = getEventHandleFromProps();\n      Object.keys(eventDict).forEach((event) => {\n        instance.on(eventDict[event], props[event]);\n      });\n      instance.setValue(value || '');\n\n      if (width || height) {\n        // 设置尺寸\n        instance.setSize(width, height);\n      }\n      setEditor(instance);\n      setOptions(instance, {...defaultOptions, ...options});\n    }\n    return () => {\n      if (editor && window) {\n        editor.toTextArea();\n        setEditor(undefined);\n      }\n    }\n  }, []);\n\n  useMemo(() => {\n    if (!editor || !window) return;\n    const val = editor.getValue();\n    if (value !== undefined && value !== val) {\n      editor.setValue(value);\n    }\n  }, [value]);\n\n  useMemo(() => {\n    if (!editor || !window) return;\n    editor.setSize(width, height);\n  }, [width, height]);\n\n\n  useMemo(() => {\n    if (!editor || !window) return;\n    setOptions(editor, {...defaultOptions, ...options});\n  }, [options]);\n  \n  return (\n    <textarea ref={textareaRef} />\n  );\n}\n\nexport default React.forwardRef(ReactCodeMirror);"]}