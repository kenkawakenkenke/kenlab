{"version":3,"sources":["../../src/index.js"],"names":["defaultOptions","tabSize","autoCloseBrackets","matchBrackets","showCursorWhenSelecting","lineNumbers","fullScreen","ReactCodeMirror","props","ref","options","value","width","height","editor","setEditor","textareaRef","getEventHandleFromProps","propNames","Object","keys","eventHandle","filter","keyName","test","eventDict","forEach","ele","name","slice","replace","toLowerCase","setOptions","instance","opt","window","mode","CodeMirror","findModeByName","mime","JSON","stringify","setOption","fromTextArea","current","event","on","setValue","setSize","toTextArea","undefined","val","getValue","React","forwardRef"],"mappings":"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","sourcesContent":["import React, { useRef, useEffect, useImperativeHandle, useState, useMemo } from 'react';\nimport CodeMirror from 'codemirror';\nimport 'codemirror/mode/meta';\nimport './codemirror.css';\nimport './index.css';\n\nconst defaultOptions = {\n  tabSize: 2,\n  autoCloseBrackets: true,\n  matchBrackets: true,\n  showCursorWhenSelecting: true,\n  // 显示行号\n  lineNumbers: true,\n  fullScreen: true,\n}\n\nfunction ReactCodeMirror(props = {}, ref) {\n  const { options = {}, value = '', width = '100%', height = '100%'  } = props;\n  const [editor, setEditor] = useState();\n  const textareaRef = useRef();\n  useImperativeHandle(ref, () => ({ editor }), [editor]);\n  // 将props中所有的事件处理函数映射并保存\n  function getEventHandleFromProps() {\n    const propNames = Object.keys(props);\n    const eventHandle = propNames.filter((keyName) => {\n      return /^on+/.test(keyName);\n    });\n\n    const eventDict = {};\n    eventHandle.forEach((ele) => {\n      const name = ele.slice(2);\n      eventDict[ele] = name.replace(name[0],name[0].toLowerCase());\n    });\n\n    return eventDict;\n  }\n\n  // http://codemirror.net/doc/manual.html#config\n  async function setOptions(instance, opt = {}) {\n    if (typeof opt === 'object' && window) {\n      const mode = CodeMirror.findModeByName(opt.mode || '');\n      if (mode && mode.mode) {\n        await import(`codemirror/mode/${mode.mode}/${mode.mode}.js`);\n      }\n      if (mode) {\n        opt.mode = mode.mime;\n      }\n      Object.keys(opt).forEach((name) => {\n        if (opt[name] && JSON.stringify(opt[name])) {\n          instance.setOption(name, opt[name]);\n        }\n      });\n    }\n  }\n\n  useEffect(() => {\n    if (!editor && window) {\n      // 生成codemirror实例\n      const instance = CodeMirror.fromTextArea(textareaRef.current, {...defaultOptions, ...options});\n      const eventDict = getEventHandleFromProps();\n      Object.keys(eventDict).forEach((event) => {\n        instance.on(eventDict[event], props[event]);\n      });\n      instance.setValue(value || '');\n\n      if (width || height) {\n        // 设置尺寸\n        instance.setSize(width, height);\n      }\n      setEditor(instance);\n      setOptions(instance, {...defaultOptions, ...options});\n    }\n    return () => {\n      if (editor && window) {\n        editor.toTextArea();\n        setEditor(undefined);\n      }\n    }\n  }, []);\n\n  useMemo(() => {\n    if (!editor || !window) return;\n    const val = editor.getValue();\n    if (value !== undefined && value !== val) {\n      editor.setValue(value);\n    }\n  }, [value]);\n\n  useMemo(() => {\n    if (!editor || !window) return;\n    editor.setSize(width, height);\n  }, [width, height]);\n\n\n  useMemo(() => {\n    if (!editor || !window) return;\n    setOptions(editor, {...defaultOptions, ...options});\n  }, [options]);\n  \n  return (\n    <textarea ref={textareaRef} />\n  );\n}\n\nexport default React.forwardRef(ReactCodeMirror);"]}